name: Auto Wake and Refresh All Services

on:
  push:
    branches:
      - main  # or master if thatâ€™s your repo default

jobs:
  wake-and-refresh:
    runs-on: ubuntu-latest

    steps:
      - name: Step 1 - Wake up Config Server
        run: |
          echo "ğŸ“¡ Waking up Config Server..."
          curl -s -o /dev/null https://funmarketconfigserver-dckt.onrender.com/actuator/health || true

      - name: Step 2 - Wake up all Microservices
        run: |
          echo "ğŸ“¡ Waking up Stock market DB Service..."
          curl -s -o /dev/null https://funmarketdb.onrender.com/actuator/health || true
		  
		   - name: Step 3 - Wake up all Microservices
        run: |
          echo "ğŸ“¡ Waking up Stock market git reader service..."
          curl -s -o /dev/null https://funmarketgitreader.onrender.com/actuator/health || true

      - name: Step 4 - Wait for all services to fully start (5 min 00 sec)
        run: |
          echo "â³ Waiting 130 seconds for all Render services to finish waking up..."
          sleep 300

      - name: Step 5 - Stabilize network for 20 seconds
        run: |
          echo "ğŸ’¤ Sleeping for 20 seconds before triggering refresh..."
          sleep 20

	  - name âœ… Done
		run echo "All services are awake and configurations refreshed!"
		
      - name: Step 6 - Trigger Config Server Bus Refresh
        run: |
          echo "ğŸš€ Sending bus refresh to Config Server..."
          curl -X POST \
            -H "Content-Type: application/json" \
			https://funmarketgitreader.onrender.com/fun-market/git-reader/git-read || true

      - name: âœ… Done
        run: echo "ğŸ‰ Data inseration Completed successfully!..."
